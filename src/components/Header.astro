---
import MenuPills from './MenuPills.astro'

import HomeIcon from '../assets/icons/Home.astro'
import ExperienceIcon from '../assets/icons/Experience.astro'
import ProjectsIcon from '../assets/icons/Projects.astro'
import ContactIcon from '../assets/icons/Contact.astro'

import '../styles/switchTheme.css'
import '../styles/troggleButton.css'
---

<header 
class="fixed top-0 w-full z-[999] bg-gray-300/10 backdrop-blur-3xl md:bg-gray-600/10 md:backdrop-blur-5xl" 
> 
    <!-- navbar -->
    <div 
    class="relative flex flex-row max-w-4xl mx-auto justify-end items-center px-3 py-5"
    >
        <nav
        id="landing-header"
        class="font-sans flex flex-row items-center justify-center md:space-x-9 font-[400] text-black dark:text-white"
        >
            
            <!-- Botón switch theme -->
            <div class="container pr-2 md:pr-0">
                <label for="theme-toggle" class="toggle">
                    <input type="checkbox" class="input" id="theme-toggle" />
                    <div class="icon icon--moon">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 24 24"
                            fill="currentColor"
                            width="20"
                            height="20"
                        >
                            <path
                            fill-rule="evenodd"
                            d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z"
                            clip-rule="evenodd"
                            ></path>
                        </svg>
                    </div>

                    <div class="icon icon--sun">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 24 24"
                            fill="currentColor"
                            width="20"
                            height="20"
                        >
                            <path
                            d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"
                            ></path>
                        </svg>
                    </div>
                </label>
            </div>

            <!-- links -->
            <div class="hidden md:flex flex-row space-x-9">
                <a class="py-1 px-2" href="/">Home</a>
                <a class="py-1 px-2" href="/about">About</a>
                <a class="py-1 px-2" href="/projects">Projects</a>
                <a class="py-1 px-2" href="/contact">Contact</a>
            </div>

            <!-- Mobile button - menu -->
            <div class="absolute md:hidden left-5">
                <!-- Button -->
                <input type="checkbox" id="mini-checkbox" class="mini-checkbox">
                <label for="mini-checkbox" class="mini-toggle">
                    <div class="mini-bar mini-bar--top"></div>
                    <div class="mini-bar mini-bar--middle"></div>
                    <div class="mini-bar mini-bar--bottom"></div>
                </label>

                <!-- Menu mobile -->
                <div class="mobile-menu md:hidden absolute top-12 left-0">
                    <div>
                        <nav class="flex flex-col space-y-2 dark:text-white">
                            <div class="menu-item">
                                <MenuPills>
                                    <HomeIcon/>
                                    <span class="font-sans">Home</span>
                                </MenuPills>
                            </div>
                            <div class="menu-item">
                                <MenuPills>
                                    <ExperienceIcon/>
                                    <span class="font-sans">Experience</span>
                                </MenuPills>
                            </div>
                            <div class="menu-item">
                                <MenuPills>
                                    <ProjectsIcon/>
                                    <span class="font-sans">Projects</span>
                                </MenuPills>
                            </div>
                            <div class="menu-item">
                                <MenuPills>
                                    <ContactIcon/>
                                    <span class="font-sans">Contact</span>
                                </MenuPills>
                            </div>
                        </nav>
                    </div>
                </div>
            </div>
        </nav>
    </div>

    <!-- Cuadro para hover del menú -->
    <div
        id="menu-backdrop"
        class={`
        absolute bg-gray-400/30 dark:bg-white/30 backdrop-blur-xl rounded
        translate-x-[var(--left)] translate-y-[var(--top)]
        w-[var(--width)] h-[var(--height)]
        left-0 top-0
        transition-all duration-500
        ease-in-out opacity-0 -z-10
        `}
    ></div>
</header>

<!-- Script animación del hover del menú -->
<script>
    const listItem = document.querySelectorAll("#landing-header a")
    const menuBackdrop = document.querySelector("#menu-backdrop") as HTMLElement
    const headerElement = document.querySelector('header') as HTMLElement

    listItem.forEach((item) => {
        item.addEventListener("mouseenter", () => {
        const itemRect = item.getBoundingClientRect()
        const headerRect = headerElement.getBoundingClientRect()
        
        const left = itemRect.left - headerRect.left
        const top = itemRect.top - headerRect.top
        
        menuBackdrop.style.setProperty("--left", `${left}px`)
        menuBackdrop.style.setProperty("--top", `${top}px`)
        menuBackdrop.style.setProperty("--width", `${itemRect.width}px`)
        menuBackdrop.style.setProperty("--height", `${itemRect.height}px`)
        menuBackdrop.style.opacity = "1"
        menuBackdrop.style.visibility = "visible"
    })
        item.addEventListener("mouseleave", ()=>{
            menuBackdrop.style.opacity = "0"
            menuBackdrop.style.visibility = "hidden"

        })
    })
</script>

<script>
    const headerEl = document.querySelector('#landing-header') as HTMLElement
    const obserserOptions = {
        root: null,
        rootMargin: '0px',
        threshold: 0.90,
    }

    const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
            const { isIntersecting } = entry
            if (isIntersecting){
                const color = entry.target.getAttribute("data-header-color")
                if (color) {
                    headerEl.style.color = color;
                } else {
                    console.warn('El atributo data-header-color es null.');
                }
            }
        })
    }, obserserOptions)

    const sectionsElement = document.querySelectorAll('.landing-section')
    sectionsElement.forEach((section) => observer.observe(section))
</script>