---
import Badge from '../components/Badge.astro';
import Layout from '../layouts/Layout.astro';
import SocialPills from '../components/SocialPills.astro'

import GitHubIcon from '../assets/icons/GitHub.astro'
import LinkedInIcon from '../assets/icons/LinkedIn.astro'
import MailIcon from '../assets/icons/Mail.astro'

import ilustracion from '../assets/img/miCaricatura.webp'

import '../styles/cursorAnimated.css'

// Welcome to Astro! Wondering what to do next? Check out the Astro documentation at https://docs.astro.build
// Don't want to use any of this? Delete everything in this file, the `assets`, `components`, and `layouts` directories, and start fresh.
---

<Layout>
	<!-- Main content, acá (Main) se modifica las posiciones del content para el dektstop mode -->
	<main
	class="min-h-[100dvh] md:flex md:items-center"
	>
		<div class="w-full">
			<!-- Textos -->
			<section
			class="flex flex-col p-2 max-w-5xl mx-auto"
			>
				<h1
				id="typing-text"
				class="font-monospace max-w-5xl font-bold bg-gradient-to-r from-blue-500 to-pink-600 bg-clip-text text-transparent text-5xl px-1 pt-15 pb-2 md:pt-1 md:pb-5 md:px-3 animated"
				></h1>

                <div
                class="hidden md:flex flex-col md:px-3 text-lg text-gray-700 dark:text-white"
                >
                    <p>
                    <span 
                    class="font-bold text-black dark:text-amber-100"
                    >
                        Desarrollador Frontend con conocimientos en backend, ubicado en Colombia.
                    </span>
                        Me especializo en crear sitios web responsivos y visualmente atractivos, combinando un diseño UI limpio con funcionalidad sólida. Aunque mi enfoque principal es el desarrollo frontend, también aprovecho las tecnologías backend para entregar soluciones web completas.
                    </p>
                </div>
			</section>
	
			<!-- Badge y redes -->
			<section
			class="absolute left-1/2 top-65 -translate-x-1/2 space-y-2 flex flex-col justify-center max-w-5xl md:mx-auto md:static md:translate-x-0 md:left-auto md:top-auto md:mt-3 md:space-y-3"
			>
				<!-- Bagde -->
				<div class="flex justify-center items-center">
					<Badge>Disponible para trabajar</Badge>
				</div>
				
				<!-- Redes -->
				<nav class="flex justify-center items-center space-x-3">
					<SocialPills
					href="https://github.com/Camilo-Pal0"
					>
						<GitHubIcon/>
						<span class="hidden md:flex">GitHub</span>
					</SocialPills>

					<SocialPills
					href="https://www.linkedin.com/in/camilo-palomeque-2b25322ba/"
					>
						<LinkedInIcon/>
						<span class="hidden md:flex">LinkedIn</span>
					</SocialPills>

					<SocialPills
					href="mailto:camilopalomeque79@gmail.com"
					>
						<MailIcon/>
						<span class="hidden md:flex">Camilopalomeque79@gmail.com</span>
					</SocialPills>
				</nav>
			</section>

			<!-- Ilustración -->
			<section 
			class="absolute bottom-0 w-full flex items-center justify-center leading-none md:z-[10] pointer-events-none"
			>
				<div>
					<img 
                    class="w-65 block" 
                    src={ilustracion.src} 
                    alt="Ilustración personal">
				</div>
			</section>
		</div>
	</main>

<!-- script para texto animado-->
<script is:inline>
class TypingAnimation {
    constructor(elementId, phrases, options = {}) {
        this.element = document.getElementById(elementId);
        this.phrases = phrases;
        
        // Configuración optimizada
        this.config = {
            typingSpeed: options.typingSpeed || 80,
            erasingSpeed: options.erasingSpeed || 30,
            pauseAfterType: options.pauseAfterType || 2000,
            pauseAfterErase: options.pauseAfterErase || 500,
            ...options
        };
        
        // Estado
        this.currentPhraseIndex = 0;
        this.currentCharIndex = 0;
        this.isTyping = true;
        this.isRunning = false;
        this.animationId = null;
        
        if (!this.element) {
            console.error('Elemento no encontrado:', elementId);
            return;
        }
        
        this.log('Inicializado correctamente');
        this.start();
    }

    
    log(message) {
        /* console.log(`TypingAnimation: ${message}`); */
    }
    
    start() {
        if (this.isRunning) return;
        this.isRunning = true;
        this.showCursor();
        this.log('Animación iniciada');
        this.scheduleNext();
    }
    
    stop() {
        this.isRunning = false;
        if (this.animationId) {
            clearTimeout(this.animationId);
            this.animationId = null;
        }
        this.hideCursor();
        this.log('Animación detenida');
    }
    
    showCursor() {
        // El cursor ::after siempre está visible, no necesita control
    }
    
    hideCursor() {
        // El cursor ::after siempre está visible, no necesita control
    }
    
    scheduleNext() {
        if (!this.isRunning) return;
        
        let delay;
        
        if (this.isTyping) {
            delay = this.typeNextCharacter();
        } else {
            delay = this.eraseNextCharacter();
        }
        
        this.animationId = setTimeout(() => {
            this.scheduleNext();
        }, delay);
    }
    
    typeNextCharacter() {
        const currentPhrase = this.phrases[this.currentPhraseIndex];
        
        if (this.currentCharIndex < currentPhrase.length) {
            // Escribir el siguiente carácter
            this.currentCharIndex++;
            this.updateDisplay();
            this.log(`Escribiendo: "${this.getDisplayText()}"`);
            
            // Velocidad variable: más lento en puntuación
            const currentChar = currentPhrase[this.currentCharIndex - 1];
            const isPunctuation = /[.!?,:;]/.test(currentChar);
            return isPunctuation ? this.config.typingSpeed * 2 : this.config.typingSpeed;
        } else {
            // Frase completa, cambiar a modo borrado
            this.log(`Frase completa: "${currentPhrase}"`);
            this.isTyping = false;
            return this.config.pauseAfterType;
        }
    }
    
    eraseNextCharacter() {
        const currentPhrase = this.phrases[this.currentPhraseIndex];
        const nextPhrase = this.phrases[(this.currentPhraseIndex + 1) % this.phrases.length];
        
        // Determinar hasta dónde borrar
        const commonPrefix = this.findCommonPrefix(currentPhrase, nextPhrase);
        const eraseToIndex = commonPrefix.length;
        
        if (this.currentCharIndex > eraseToIndex) {
            // Borrar carácter
            this.currentCharIndex--;
            this.updateDisplay();
            this.log(`Borrando: "${this.getDisplayText()}"`);
            return this.config.erasingSpeed;
        } else {
            // Cambiar a la siguiente frase
            this.currentPhraseIndex = (this.currentPhraseIndex + 1) % this.phrases.length;
            this.isTyping = true;
            this.log(`Cambiando a frase ${this.currentPhraseIndex + 1}`);
            return this.config.pauseAfterErase;
        }
    }
    
    findCommonPrefix(str1, str2) {
        let commonPrefix = '';
        const minLength = Math.min(str1.length, str2.length);
        
        for (let i = 0; i < minLength; i++) {
            if (str1[i] === str2[i]) {
                commonPrefix += str1[i];
            } else {
                break;
            }
        }
        
        return commonPrefix;
    }
    
    updateDisplay() {
        const currentPhrase = this.phrases[this.currentPhraseIndex];
        const displayText = currentPhrase.substring(0, this.currentCharIndex);
        this.element.textContent = displayText;
    }
    
    getDisplayText() {
        return this.element.textContent;
    }
    
    // Método público para cambiar velocidades
    updateConfig(newConfig) {
        this.config = { ...this.config, ...newConfig };
        this.log('Configuración actualizada');
    }
}

// Inicializar cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', function() {
    const phrases = [
        "¡Buenas! soy Camilo...",
        "¡Buenas! soy diseñador",
        "¡Buenas! soy programador",
        "y disfruto crear experiencias digitales."
    ];
    
    const typingAnimation = new TypingAnimation('typing-text', phrases, {
        typingSpeed: 100,        // Velocidad de tipeo
        erasingSpeed: 50,        // Velocidad de borrado
        pauseAfterType: 2000,    // Pausa después de completar
        pauseAfterErase: 300     // Pausa antes de empezar nueva frase
    });
    
    // Controles de teclado (opcional)
    document.addEventListener('keydown', function(e) {
        switch(e.key) {
            case ' ':
                e.preventDefault();
                if (typingAnimation.isRunning) {
                    typingAnimation.stop();
                } else {
                    typingAnimation.start();
                }
                break;
            case 'ArrowUp':
                e.preventDefault();
                typingAnimation.updateConfig({
                    typingSpeed: Math.max(20, typingAnimation.config.typingSpeed - 10)
                });
                break;
            case 'ArrowDown':
                e.preventDefault();
                typingAnimation.updateConfig({
                    typingSpeed: Math.min(200, typingAnimation.config.typingSpeed + 10)
                });
                break;
        }
    });
});
</script>
</Layout>
